{% extends "layout.html" %}

{% block title %}Prediction{% endblock %}

{% block content %}
<div class="relative flex min-h-screen flex-col">
    <!-- HEADER -->
    <header class="sticky top-0 z-50 flex items-center justify-between whitespace-nowrap border-b border-solid border-b-[#283339] bg-[#1c2327] px-10 py-3">
        <div class="flex items-center gap-3 text-white">
            <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Electra Sense Logo" class="logo-img">
            <h2 class="text-xl font-bold tracking-tight">Electra Sense</h2>
        </div>
        <nav class="hidden items-center gap-8 md:flex">
            <a class="text-sm font-medium text-white" href="{{ url_for('home') }}">Home</a>
            <a class="text-sm font-medium text-gray-300 transition-colors hover:text-white" href="#">About</a>
            <a class="text-sm font-medium text-gray-300 transition-colors hover:text-white" href="#">Contact</a>
        </nav>
        <div>
            <a href="{{ url_for('signin') }}" class="inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors h-10 px-4 py-2 bg-red-600 text-white shadow-lg hover:bg-red-700">
                Log Out
            </a>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="flex-grow">
        <section class="hero-section flex min-h-[calc(100vh-68px)] items-center justify-center px-4 text-center">
            <div class="form-container w-full max-w-3xl">
                <h1 class="text-4xl font-black leading-tight tracking-tighter sm:text-5xl md:text-6xl">Predict Your Electricity Bill</h1>
                <p class="mt-4 text-lg text-gray-300">
                    Enter your consumption data to get an accurate estimate of your upcoming electricity bill.
                </p>
                <form id="prediction-form" class="mt-8 flex w-full max-w-lg mx-auto flex-col gap-4">
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div class="relative"><span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">category</span><select name="tariff_category" class="form-select w-full rounded-md border border-[#3b4b54] bg-[#1c2327] py-3 pl-10 pr-4 text-base text-white placeholder:text-gray-400 focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)]" required><option disabled selected value="">Tariff Category</option><option value="Residential">Residential</option><option value="Commercial">Commercial</option><option value="Industrial">Industrial</option></select></div>
                        <div class="relative"><span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">offline_bolt</span><input name="sanctioned_load" class="form-input w-full rounded-md border border-[#3b4b54] bg-[#1c2327] py-3 pl-10 pr-4 text-base text-white placeholder:text-gray-400 focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)]" placeholder="Sanctioned Load (kW)" type="number" step="any" required /></div>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div class="relative"><span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">power</span><input name="units_consumed" class="form-input w-full rounded-md border border-[#3b4b54] bg-[#1c2327] py-3 pl-10 pr-4 text-base text-white placeholder:text-gray-400 focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)]" placeholder="Units Consumed (kWh)" type="number" step="any" required /></div>
                        <div class="relative"><span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">request_quote</span><input name="energy_charge" class="form-input w-full rounded-md border border-[#3b4b54] bg-[#1c2327] py-3 pl-10 pr-4 text-base text-white placeholder:text-gray-400 focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)]" placeholder="Energy Charge (₹ per kWh)" type="number" step="any" required /></div>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div class="relative"><span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">payments</span><input name="fixed_charges" class="form-input w-full rounded-md border border-[#3b4b54] bg-[#1c2327] py-3 pl-10 pr-4 text-base text-white placeholder:text-gray-400 focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)]" placeholder="Fixed Charges (₹)" type="number" step="any" required /></div>
                        <div class="relative"><span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">receipt_long</span><input name="electricity_duty" class="form-input w-full rounded-md border border-[#3b4b54] bg-[#1c2327] py-3 pl-10 pr-4 text-base text-white placeholder:text-gray-400 focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)]" placeholder="Electricity Duty (%)" type="number" step="any" required /></div>
                    </div>
                    <button type="submit" class="flex min-w-[120px] w-full cursor-pointer items-center justify-center rounded-md bg-[var(--primary-color)] px-6 py-3 text-base font-bold text-white shadow-lg transition-transform hover:scale-105"><span class="truncate">Predict</span></button>
                </form>
            </div>
        </section>
        
        <section id="results-section" class="hidden bg-[#111618] py-20 px-4 sm:px-10">
            <div class="mx-auto max-w-4xl text-center">
                <h2 class="text-3xl font-bold tracking-tight">Your Predicted Bill</h2>
                <p class="mt-4 text-lg text-gray-300">Based on your consumption data, here is the estimated electricity bill for the next cycle.</p>
            </div>
            <div class="mt-12 mx-auto max-w-4xl flex flex-col items-center justify-center gap-8 md:flex-row md:items-start">
                <div class="output-box flex flex-col items-center justify-center p-8 md:w-1/2">
                    <h3 class="text-xl font-bold text-[var(--primary-color)]">Predicted Amount</h3>
                    <p id="predicted-amount" class="mt-2 text-6xl font-black tracking-tight text-white">₹0.00</p>
                    <div class="mt-4 flex items-center gap-2 text-gray-400"><span class="material-symbols-outlined text-lg">verified</span><span id="confidence-level" class="text-sm">Confidence: 95%</span></div>
                </div>
                <div class="output-box w-full p-8 md:w-1/2">
                    <h3 class="text-xl font-bold text-center text-white">Prediction Breakdown</h3>
                    <ul class="mt-6 space-y-4 text-left">
                        <li class="flex justify-between items-center"><span class="text-gray-400">Tariff Category:</span><span id="breakdown-tariff" class="font-medium text-white">-</span></li>
                        <li class="flex justify-between items-center"><span class="text-gray-400">Sanctioned Load:</span><span id="breakdown-load" class="font-medium text-white">-</span></li>
                        <li class="flex justify-between items-center"><span class="text-gray-400">Units Consumed:</span><span id="breakdown-units" class="font-medium text-white">-</span></li>
                        <li class="flex justify-between items-center"><span class="text-gray-400">Base Energy Charge:</span><span id="breakdown-energy" class="font-medium text-white">-</span></li>
                        <li class="flex justify-between items-center"><span class="text-gray-400">Fixed Charges:</span><span id="breakdown-fixed" class="font-medium text-white">-</span></li>
                        <li class="flex justify-between items-center"><span class="text-gray-400">Electricity Duty:</span><span id="breakdown-duty" class="font-medium text-white">-</span></li>
                    </ul>
                    <div class="mt-6 border-t border-[#3b4b54] pt-4 text-center"><p class="text-sm text-gray-500">This is an estimate. Actual bill may vary.</p></div>
                </div>
            </div>

            <!-- NEW: Gemini Feature Section -->
            <div class="mt-12 mx-auto max-w-4xl text-center">
                <button id="get-tips-btn" class="gemini-button">
                    ✨ Get Personalized Saving Tips
                </button>
                <div id="tips-container" class="hidden mt-8 text-left">
                    <div id="tips-loader" class="loader"></div>
                    <ul id="tips-list" class="hidden space-y-4">
                        <!-- AI-generated tips will be inserted here -->
                    </ul>
                </div>
            </div>
        </section>
    </main>
</div>
{% endblock %}

